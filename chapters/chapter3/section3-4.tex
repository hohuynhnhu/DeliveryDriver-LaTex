\section{Sequence Diagram}

\subsection{Sequence Diagram đăng ký tài khoản}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Dangkytaikhoansequence.jpg}
    \caption{Sequence Diagram đăng ký tài khoản}
    \label{fig:dangkytaikhoan_seq}
\end{figure}

Sơ đồ mô tả quy trình đăng ký tài khoản người dùng mới trong hệ thống.
Người dùng nhập thông tin đăng ký thông qua ứng dụng Mobile App, sau đó hệ thống Backend API tiếp nhận và gửi yêu cầu tạo người dùng đến Supabase Auth.
Trong trường hợp email đã tồn tại, hệ thống sẽ trả về lỗi trùng lặp; ngược lại, nếu thông tin hợp lệ, hệ thống tiến hành tạo tài khoản mới, lưu trữ hồ sơ người dùng vào PostgreSQL và sử dụng Email Service để gửi thư xác thực.
Quy trình hoàn tất khi hệ thống thông báo đăng ký thành công và yêu cầu người dùng kiểm tra email để kích hoạt tài khoản.

\subsection{Sequence Diagram đăng nhập hệ thống}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Dangnhaphethongsequence.jpg}
    \caption{Sequence Diagram đăng nhập hệ thống}
    \label{fig:dangnhaphethong_seq}
\end{figure}

Sơ đồ mô tả quy trình xác thực và đăng nhập vào hệ thống.
Người dùng nhập Email và Mật khẩu thông qua ứng dụng Mobile App, sau đó hệ thống gửi thông tin đến Backend API để thực hiện xác thực với Supabase.
Trong trường hợp thông tin đăng nhập sai, hệ thống trả về lỗi xác thực; ngược lại, nếu thông tin hợp lệ, hệ thống tiếp tục truy vấn PostgreSQL để lấy thông tin chi tiết người dùng (Vai trò và Trạng thái).
Quy trình kiểm tra tiếp trạng thái tài khoản: nếu bị khóa sẽ thông báo vô hiệu hóa, nếu hoạt động bình thường sẽ thiết lập phiên làm việc và chuyển hướng người dùng vào màn hình chính.

\subsection{Sequence Diagram tạo đơn hàng mới}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Taodonhangmoisequence.jpg}
    \caption{Sequence Diagram tạo đơn hàng mới}
    \label{fig:taodonhangmoi_seq}
\end{figure}

Sơ đồ mô tả quy trình khách hàng khởi tạo một yêu cầu giao hàng mới trên hệ thống.
Khách hàng nhập thông tin người gửi và người nhận trên ứng dụng Customer App, sau đó Backend API thực hiện kiểm tra địa chỉ và tính toán khoảng cách thông qua Map Service để xác nhận khả năng phục vụ.
Sau khi địa chỉ được xác thực, khách hàng nhập thông tin hàng hóa và gửi yêu cầu tạo đơn. Hệ thống tiến hành lưu trữ bản ghi đơn hàng mới vào PostgreSQL, khởi tạo Mã vận đơn và đặt trạng thái ban đầu là ``Chờ xử lý''.
Quy trình kết thúc khi hệ thống thông báo tạo đơn thành công và chuyển hướng khách hàng đến màn hình chi tiết đơn hàng vừa tạo.

\subsection{Sequence Diagram phân công đơn hàng}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Phancongdonhangsequence.jpg}
    \caption{Sequence Diagram phân công đơn hàng}
    \label{fig:phancongdonhang_seq}
\end{figure}

Sơ đồ mô tả quy trình Quản trị viên (Admin) thực hiện phân công đơn hàng cho tài xế thông qua giao diện Web Admin, có tích hợp sự hỗ trợ từ thuật toán gợi ý thông minh.

Quy trình bắt đầu khi Admin chọn đơn hàng cần xử lý. Hệ thống Backend API không chỉ truy vấn dữ liệu từ PostgreSQL mà còn kích hoạt thuật toán MBA nội bộ để phân tích vị trí, lịch sử và các luật kết hợp, từ đó trả về danh sách tài xế được sắp xếp theo độ phù hợp cao nhất.

Sau khi Admin chọn tài xế từ danh sách gợi ý và gửi yêu cầu phân công, hệ thống thực hiện kiểm tra logic nghiệp vụ về số lượng đơn hàng tài xế đang thực hiện.
Nếu tài xế đang trong trạng thái quá tải (vượt định mức cho phép), hệ thống lập tức trả về cảnh báo lỗi và ngăn chặn việc gán đơn.
Trong trường hợp tài xế đủ điều kiện tiếp nhận, hệ thống tiến hành cập nhật thông tin người phụ trách vào cơ sở dữ liệu, đồng thời gọi Notification Service để gửi thông báo nhận việc tức thời đến ứng dụng của tài xế và cập nhật trạng thái thành công trên giao diện quản trị.
\subsection{Sequence Diagram thực hiện lấy hàng}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Thuchienlayhangsequence.jpg}
    \caption{Sequence Diagram thực hiện lấy hàng}
    \label{fig:thuchienlayhang_seq}
\end{figure}

Sơ đồ mô tả quy trình tài xế thực hiện nhận hàng hóa tại điểm lấy.
Khi tài xế đến nơi, họ xác nhận trên ứng dụng Driver App, sau đó Backend API ghi nhận thời gian, vị trí vào PostgreSQL và gửi thông báo cho khách hàng qua Notification Service.
Tiếp theo, tài xế kiểm tra hàng hóa, chụp ảnh bằng chứng và gửi xác nhận lên hệ thống. Tại đây quy trình rẽ nhánh: nếu hàng hóa đúng quy định, hệ thống lưu ảnh, cập nhật trạng thái đơn hàng sang ``Đang giao hàng'' và thông báo cho khách.
Ngược lại, trong trường hợp hàng hóa sai lệch hoặc hư hỏng, hệ thống ghi nhận sự cố, gửi cảnh báo đến Admin và hủy nhiệm vụ lấy hàng hiện tại.

\subsection{Sequence Diagram thực hiện giao hàng}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Thuchiengiaohangsequence.jpg}
    \caption{Sequence Diagram thực hiện giao hàng}
    \label{fig:thuchiengiaohang_seq}
\end{figure}

Sơ đồ mô tả quy trình tài xế thực hiện các bước cuối cùng để giao kiện hàng cho người nhận.
Quy trình bắt đầu khi tài xế thực hiện gọi điện cho người nhận qua Driver App; Backend API sẽ hỗ trợ kết nối bằng cách truy xuất số điện thoại ảo từ cơ sở dữ liệu để bảo mật thông tin.
Sau khi tương tác với khách, tài xế cập nhật kết quả giao hàng kèm hình ảnh bằng chứng lên hệ thống. Tại đây, quy trình rẽ nhánh dựa trên kết quả thực tế:
Trong trường hợp giao thành công, hệ thống lưu ảnh bằng chứng, cập nhật trạng thái đơn hàng thành ``Giao thành công'' và gửi thông báo đến khách hàng.
Ngược lại, nếu giao thất bại, hệ thống ghi nhận lý do, cập nhật trạng thái lỗi và gửi cảnh báo đến cả Admin lẫn khách hàng để xử lý quy trình hoàn hàng.

\subsection{Sequence Diagram xử lý sự cố đơn hàng}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Xulysucodonhangsequence.jpg}
    \caption{Sequence Diagram xử lý sự cố đơn hàng}
    \label{fig:xulysucodonhang_seq}
\end{figure}

Sơ đồ mô tả quy trình quản trị viên giải quyết các vấn đề phát sinh đối với đơn hàng thông qua giao diện Web Admin.
Quản trị viên bắt đầu bằng việc tìm kiếm đơn hàng lỗi; hệ thống Backend API sẽ truy vấn PostgreSQL để lấy dữ liệu chi tiết hiển thị lên màn hình.
Sau khi quản trị viên chọn hành động xử lý, quy trình rẽ nhánh dựa trên loại sự cố:
Nếu khách hàng đổi địa chỉ, hệ thống cập nhật thông tin mới; trường hợp địa chỉ mới khác khu vực hoạt động, hệ thống sẽ hủy gán tài xế hiện tại để đưa đơn về trạng thái chờ tìm tài xế mới.
Đối với trường hợp xử lý giao thất bại hoặc hủy đơn, hệ thống cập nhật trạng thái tương ứng  vào cơ sở dữ liệu.
Quy trình kết thúc khi hệ thống gửi thông báo cập nhật đến các bên liên quan thông qua Notification Service và làm mới danh sách trên giao diện quản trị.

\subsection{Sequence Diagram tra cứu hành trình đơn}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Tracuuhanhtrinhdonsequence.jpg}
    \caption{Sequence Diagram tra cứu hành trình đơn}
    \label{fig:tracuuhanhtrinhdon_seq}
\end{figure}

Sơ đồ mô tả quy trình khách hàng thực hiện kiểm tra trạng thái và lịch sử di chuyển của đơn hàng.
Khách hàng nhập Mã vận đơn trên giao diện Customer App và nhấn nút tra cứu, yêu cầu này được gửi đến Backend API.
Hệ thống truy vấn thông tin cơ bản từ PostgreSQL. Tại đây quy trình rẽ nhánh: nếu không tìm thấy đơn hàng, hệ thống báo lỗi mã không tồn tại cho người dùng.
Trong trường hợp đơn hàng hợp lệ, Backend API tiếp tục truy xuất danh sách các mốc thời gian chi tiết từ cơ sở dữ liệu.
Dữ liệu đầy đủ bao gồm thời gian tạo, thời gian lấy hàng và vị trí hiện tại được trả về để ứng dụng hiển thị dòng thời gian hành trình cho khách hàng.

\subsection{Sequence Diagram cập nhật trạng thái hoạt động}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/Capnhattrangthaihoatdongsequence.jpg}
    \caption{Sequence Diagram cập nhật trạng thái hoạt động}
    \label{fig:capnhattrangthai_seq}
\end{figure}

Sơ đồ mô tả quy trình tài xế thay đổi trạng thái làm việc (Rảnh, Bận, Hết ca...) trên ứng dụng Driver App để hệ thống điều phối đơn hàng phù hợp.
Tài xế chọn trạng thái mới từ menu, ứng dụng gửi yêu cầu đến Backend API. Quy trình xử lý rẽ nhánh đặc biệt khi tài xế chọn trạng thái ``Hết ca làm''.
Trong trường hợp này, hệ thống kiểm tra PostgreSQL xem còn đơn hàng chưa hoàn thành không. Nếu còn, hệ thống gửi cảnh báo lỗi yêu cầu hoàn tất; nếu không còn vướng bận, hệ thống cập nhật trạng thái nghỉ, chốt tổng kết ca và ghi nhận thời gian kết thúc.
Đối với các trạng thái thông thường khác (Rảnh, Bận), hệ thống thực hiện cập nhật trực tiếp vào cơ sở dữ liệu và gửi thông báo thay đổi thành công để ứng dụng hiển thị trạng thái hiện tại.

\subsection{Sequence Diagram Tối ưu hoá phân bổ lịch trình}

\begin{figure}[H]
    \centering
    \includegraphics[height=0.4\textheight]{frontmatter/image/ToiUuHoaPhanBoLichTrinh-SD.jpeg}
    \caption{Sequence Diagram tối ưu hoá phân bổ lịch trình}
    \label{fig:toiuuhoalichtrinh_seq}
\end{figure}

Sơ đồ trình tự mô tả quy trình tối ưu hóa lịch trình giao hàng tự động bắt đầu từ việc Quản trị viên gửi yêu cầu, hệ thống sẽ ngay lập tức truy vấn dữ liệu đơn hàng và tài xế để kiểm tra điều kiện cần; nếu dữ liệu hợp lệ, bộ điều phối gọi Thuật toán Di truyền (GA) để thực hiện hàng loạt vòng lặp tiến hóa nhằm tìm ra phương án phân bổ có điểm Fitness cao nhất dựa trên độ ưu tiên và quãng đường, sau đó kết quả được gán số thứ tự giao hàng, lưu trữ đồng bộ vào Supabase và phản hồi lịch trình hoàn chỉnh cho người dùng.